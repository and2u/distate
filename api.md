Программа для ЭВМ «DiState: Оператор ЭДО». Прикладной программный интерфейс (API)
=================================================================================
<!-- TOC -->

- [1. Введение](#1-введение)
- [2. Описание](#2-описание)
    - [2.1. Структуры данных](#21-структуры-данных)
    - [2.2. Функции API](#22-функции-api)
        - [2.2.1. Авторизация](#221-авторизация)
        - [2.2.2. Получение справочной информации](#222-получение-справочной-информации)
        - [2.2.3. Фильтрация и получение документов](#223-фильтрация-и-получение-документов)
        - [2.2.4. Принятие, отклонение и отправка документов](#224-принятие-отклонение-и-отправка-документов)
        - [2.2.5. Формирование валидных XML-документов](#225-формирование-валидных-xml-документов)
- [3. Примеры использования](#3-примеры-использования)
    - [3.1. Получение и процессинг УПД СЧФДОП документа](#31-получение-и-процессинг-упд-счфдоп-документа)
        - [3.1.1. Авторизация](#311-авторизация)
        - [3.1.2. Получение списка входящих документов](#312-получение-списка-входящих-документов)
        - [3.1.3. Получение квитанций, ожидающих подписания](#313-получение-квитанций-ожидающих-подписания)
        - [3.1.4. Подписание и отправка квитанций](#314-подписание-и-отправка-квитанций)
        - [3.1.5. Формирование титула и принятие документа](#315-формирование-титула-и-принятие-документа)
        - [3.1.6. Формирование и отправка уведомления об уточнении](#316-формирование-и-отправка-уведомления-об-уточнении)

<!-- /TOC -->

# 1. Введение

Программный интерфейс системы DiState (далее - Система) используется для интеграции Системы с информационными системами пользователей.

Описание API предназначено для разработчиков.

Программный интерфейс позволяет выполнять следующие действия:
-   отправлять документы контрагентам;
-   получать новые входящие документы;
-   получать справочную информацию;
-   формировать валидные XML-документы для создания формализованных документов.

Ниже будет более подробно рассказано о принципах работы API DiState.

# 2. Описание 

REST API сервиса DiState работает по протоколу HTTP и представляет собой набор методов, с помощью которых совершаются запросы и возвращаются ответы для каждой операции. Все ответы приходят в виде JSON-структур.

Актуальная версия API для разработчиков приведена в спецификации формата OpenApi (swagger) - см. документ [diflow.json][OpenAPI].

## 2.1. Структуры данных

Для сериализации и десериализации структур данных, передаваемых в HTTP-запросах и ответах, используется формат JSON. Для передачи структур в формате JSON, нужно передать заголовок HTTP-запроса `Content-Type: application/json`.

Бинарный контент и XML-документы передаются в теле запроса в формате [base64](https://tools.ietf.org/html/rfc4648.html#section-4).

Структуры объектов и модель данных описана в спецификации OpenAPI.

## 2.2. Функции API

Ниже дан краткий обзор функций API. Более полную информацию по всем методам и структурам данных DiState API можно найти в спецификации формата [OpenApi].

### 2.2.1. Авторизация

Для выполнения запросов посредством API требуется авторизация.

В процессе авторизации программный клиент от имени пользователя получает авторизационный токен, однозначно идентифицирующий этого пользователя и дающий клиенту право доступа к Личному кабинету DiState посредством API.

> **Комментарий**. Настройка времени жизни токена осуществляется в конфигурационном файле Системы.

Пользователь может авторизоваться в системе либо по сертификату квалифицированной электронной подписи, либо по паре логин/пароль.

Для авторизации в системе по сертификату необходимо выполнить запрос:
```
### Получение токена отправителя
POST http://{{host}}/api/security/token
Api-Version: v1.2
Content-Type: application/json

{
    "thumbprint": "{{thumbprint}}",
    "serialNumber": "{{serialNumber}}"
}
```
где ``{{host}}`` - адрес, на котором развернут сервис DiState, ``{{thumbprint}}`` - отпечаток сертификата, ``{{serialNumber}}`` - серийный номер сертификата пользователя.

В случае, если в системе есть компания, которая зарегистрирована с таким сертификатом, то в ответ придет зашифрованное на этот сертификат сообщение следующего содержания:
```
{
    "success": true,
    "token": {
        "value": "{{value}} ",
        "expireAt": "{{expireAt}}"
    }
}
```
где `{{value}}` - значение токена, `{{expireAt}}` - дата и время действия токена.

В сообщении содержится авторизационный токен `{{token}}`, который необходимо указывать во всех запросах к API в заголовке HTTP-запроса:
`Api-Token: {{token}}`.

Для авторизации в системе по логину/паролю необходимо выполнить запрос:

```
### Получение токена отправителя
POST http://{{host}}/api/security/token
Api-Version: v1.2
Content-Type: application/json
 
{
    "email": "\<логин пользователя\>",
    "password": "\<пароль пользователя\>"
}
```

В случае, если в системе есть пользователь с такой парольной парой, в ответ придет сообщение, содержащее авторизационный токен, который в дальнейшем должен передаваться в качестве заголовка HTTP-запроса к API Системы `Api-Token: {{token}}`.

### 2.2.2. Получение справочной информации

Справочная информация необходима для обработки электронных документов в клиентском приложении. Ниже перечислены основные методы получения справочных данных Системы:

| **Метод**                   | **Описание**                      | **Комментарий**                                                                                                                                                                        |
|-----------------------------|-----------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| /api/dictionary/bank        | Список банков                     | Возвращает список банков, содержащий сведения о БИК, корсчете и наименовании банка.                                                                                                    |
| /api/dictionary/country     | Список стран ОКСМ                 | Возвращает список стран. Список содержит коды и наименования стран по Общероссийскому классификатору стран (ОКСМ)                                                                      |
| /api/dictionary/currency    | Список валют ОКВ                  | Возвращает список валют. Список содержит коды и наименования валют по Общероссийскому классификатору валют.                                                                            |
| /api/dictionary/measurement | Список единиц измерения ОКЕИ      | Возвращает список единиц измерения по Общероссийскому классификатору единиц измерения (ОКЕИ). Список содержит коды, наименования и национальные условные обозначения единиц измерения. |
| /api/dictionary/region      | Список регионов                   | Возвращает список кодов и наименований регионов Российской Федерации.                                                                                                                  |
| /api/info                   | Версия API                        | Возвращает номер текущий версии API DiFlow                                                                                                                                             |
| /api/current/user           | Информация о текущем пользователе | Возвращает сведения об авторизованном пользователе (ФИО, должность, подразделение и др. данные)                                                                                        |
| /api/contractor             | Контрагенты компании              | Возвращает список контрагентов компании авторизованного пользователя (ИНН, КПП и др. реквизитами)                                                                                      |

Для поучения справочной информации необходимо отправить GET-запрос, выбрав нужный метод. Например, в ответ на запрос
```
GET http://{{host}}/api/contractor
Api-Version: v1.2
Api-Token: {{token}}
Content-Type: application/json
```
Система пришлет сведения о контрагентах компании, к которой относится пользователь. Пример ответного сообщения:
```
200 ОК

{

    "recordsTotal": 1,
    "rows": [
        {
            "id": 8,
            "name": "ООО «К-Сервис»",
            "inn": "7801486900",
            "ogrn": "1087847031909",
            "divisionId": 8,
            "kpp": "780101001",
            "title": "Основной офис",
            "address":
                {
                    "country":
                        {
                            "code": "643",
                            "title": "Россия"
                        },
                    "region":
                        {
                            "code": "78",
                            "title": "Г.Санкт-Петербург"
                        },
                    "postalCode": "194156",
                    "district": null,
                    "city": "Санкт-Петербург",
                    "settlement": "Санкт-Петербург",
                    "street": "Оптиков",
                    "house": "4",
                    "building": "Россия",
                    "room": null
                }
        }
    ]
}
```

Подробнее о структуре данных в ответных сообщениях - см. пецификацию в формате [OpenApi].

### 2.2.3. Фильтрация и получение документов

При помощи метода `/api/package`, можно быстро получать информацию о пакетах документах (например, об УПД) в Личном кабинете компании пользователя, задавая различные параметры фильтрации документов.

Например, можно запросить список всех пакетов документов со входящими УПД (СЧФДОП) ожидающих подписи получателя:
```
GET http://{{host}}/api/package?packageTypes[0]=IN&documentFlows[0]=universal_invoice_and_waybill&packageStates[0]=utd_waiting_for_buyer
```
Параметры фильтрации документов:

| **Параметр**     | **Описание**                   | **Значения**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|------------------|--------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| packageTypes     | Тип пакета документов          | IN - входящие документы,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|                  |                                | OUT - исходящие документы                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| documentStatuses | Статус документа               | received - полученные,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
|                  |                                | for_signing - необходимо подписать и отправить                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| isArchival       | Находится ли документ в архиве | 0 - нет 1 - да                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| contractor       | ID-контрагента                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| createdAt        | Интервал даты создания         | Дата в формате ДД-ММ-ГГГГ                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| documentFlows    | Тип документооборота           | universal_invoice_and_waybill - УПД (СЧФДОП) universal_invoice - УПД (СЧФ) universal_waybill - УПД (ДОП) act_552 - акт сдачи-приемки                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|                  |                                | waybill_551 - накладная                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
|                  |                                | unilateral - односторонние документы                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|                  |                                | bilateral - двусторонние документы                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|                  |                                | bill - счет                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
|                  |                                | universal_correction_document_invoice - УКД (СЧФ) universal_correction_document_invoice_and_waybill - УКД (СЧФДОП) universal_correction_document_waybill - УКД (ДОП)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| createdAt        | Интервал даты создания         | Дата в формате ДД-ММ-ГГГГ                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| packageStates    | Статус пакета                  | complete - Документооборот завершен declined - Отклонен accepted - Принят received - получен unilateral_has_been_received - Неформализованный документ получен waiting_of_receiving_confirmation - Ожидает извещения о получении annulled - Документ аннулирован, annulment_has_been_requested - Запрошено аннулирование документа, waiting_of_dp_tovtorgpok - Накладная. Ожидает титул покупателя, dp_tovtorgpr_has_been_declined - Накладная. Документ отклонен, waiting_of_dp_rezruzak - Акт. Ожидает титул заказчика, dp_rezruisp_has_been_declined - Акт отклонен, utd_waiting_for_pdpol - УПД. Ожидание получения подтверждения отправки от оператора ЭДО, utd_signing_pdpol_notification - УПД. ожидание подписания извещения о получении, utd_waiting_for_buyer - УПД. ожидание подписания покупателем, utd_waiting_of_pdotpr_seller_title_izvpol - УПД. IN. Ожидание подтверждения оператора о дате отправке извещения о получении на титул продавца,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
|                  |                                | utd_waiting_of_seller_title_izvpol - УПД. OUT. Ожидание извещения о получении титула продавца, utd_waiting_of_uvutoch_signing - УПД. IN. Ожидание подписания уведомления об уточнении, utd_waiting_of_uvutoch_izvpol - УПД. OUT. Ожидание извещения о получении уведомления об уточнении, ucd_signing_pdpol_notification - УКД. ожидание подписания извещения о получении, ucd_waiting_for_buyer - УКД. ожидание подписания покупателем, ucd_waiting_of_pdotpr_seller_title_izvpol - УКД. IN. Ожидание подтверждения оператора о дате отправке извещения о получении на титул продавца, ucd_waiting_of_seller_title_izvpol - УКД. OUT. Ожидание извещения о получении титула продавца, ucd_waiting_of_uvutoch_signing - УКД. IN. Ожидание подписания уведомления об уточнении, ucd_waiting_of_uvutoch_izvpol - УКД. OUT. Ожидание извещения о получении уведомления об уточнении                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |

Метод `/api/package/{id}/content` позволяет получить список документов пакета с выбранным идентификатором пакета:
```
GET http://{{host}}/api/package/{{documentId}}/conent
```
где `{{documentId}}` - идентификатор пакета.

Ответное сообщение содержит идентификаторы документов, объединенных в пакет. Для получения отдельных документов из пакета, необходимо выполнить запрос:
```
GET /api/document/{{id}}/content
```
где `{{id}}` - идентификатор выбранного документа.

Метод `/api/document/{id}/content` возвращает данные по документу в формате XML в поле content ответного сообщения (XML закодировано в base64):
```
{

    "content": "string",
    "signature": "string"
}
```
где поле `content` содержит XML-документ, а поле signature - электронную подпись base64.

Если требуется получить данные по выбранному документу не в формате XML, а в формате JSON необходимо воспользоваться методом `/api/document/{id}/json`.

Кроме получения пакетов и документов в форматах XML / JSON имеется возможность выгрузки пакетов документов в ZIP-архиве вместе с подписями, для этого используется метод `/archive/{id}`:
```
#@# Получение zip-архива документов
GET http://{{host}}/api//archive/{{id}}
Api-Version: v1.2
Api-Token: {{token}}
Content-Type: application/json
```
где `{{id}}` - идентификатор пакета.

### 2.2.4. Принятие, отклонение и отправка документов

Метод `/api/flow/accept/{id}` используется для принятия входящего УПД:
```
### Принятие УПД
POST http://{{host}}/api/flow/accept/{{seller_title_id}}
Api-Version: v1.2
Api-Token: {{token}}
Content-Type: application/json
    {
        "content": "{{ content }}",
        "signature": "{{ signature }}"
    }
```
где `{{ content }}` - титул получателя в base64, `{{ signature }}` - подпись получателя в base64.

Метод `/api/flow/decline/{id}` позволяет отклонить полученные сообщения:
```
### Отклонение документа
POST http://{{host}}/api/flow/decline/{id}
Api-Version: v1.2
Api-Token: {{token}}
Content-Type: application/json
    {
        "signature": "{{ signature }}",
        "content": "{{ content }}"
    }
```
где `{id}` - идентификатор входящего документа, `{{ content }}` - структура с описанием причины отклонения, `{{ signature }}` - подпись отправителя.

Метод `/api/flow/send/{documentAliases}` позволяет отправить документ получателю:
```
### Отправка
POST http://{{host}}/api/flow/send/{documentAliases}
Api-Version: v1.2
Api-Token: {{token}}
Content-Type: application/json
```
Метод `/api/signing/{id}` позволяет отправить сформированную квитанцию и подпись к ней:
```
POST http://{{host}}/api/signing/{{id}}
Api-Version: v1.2
Api-Token: {{token}}
Content-Type: application/json
    {
        "signature": "{{ signature }}",
        "content": "{{ content }}"
    }
```    
Где `{{id}}` - идентификатор квитанции, а `{{ content}}` - base64 тело сообщения (квитанции).

> **Комментарий**. Метод используется в текущей версии только для формирования квитанций.

### 2.2.5. Формирование валидных XML-документов

API предоставляет возможность (сервис) формирования документов в формате XML, соответствующих нормативным требованиям.

Метод `/api/service/document/create/{documentAlias}` формирует XML-документ по DTO (JSON).
```
### Получение zip-архива документов
POST http://{{host}}/api/service/document/create/{documentAlias}
Api-Version: v1.2
Api-Token: {{token}}
Content-Type: application/json
```
где `{documentAlias}` - ключ, определяющий тип создаваемого документа:

-   `bill` - счет
-   `universal_transfer_document_invoice` - УПД (СЧФ)
-   `universal_transfer_document_invoice_and_waybill` - УПД (СЧФДОП)
-   `universal_transfer_document_waybill` - УПД (ДОП)
-   `universal_correction_document_invoice` - УКД (СЧФ)
-   `universal_correction_document_invoice_and_waybill` - УКД (СЧФДОП)
-   `universal_correction_document_waybill` - УКД (ДОП)
-   `act552` - акт
-   `waybill551` - накладная.

Ответное сообщение содержит JSON в поле content которого, содержится сформированный XML-документ в Base64.

Метод `/api/service/receipt/create/{id}/{documentAlias}` позволяет сформировать квитанции для входящих УПД (титул покупателя):
```
### Создание титула покупателя
POST http://{{host}}/api/service/receipt/create/{{id}}/{documentAlias}
```
где `{{id}}` - идентификатор входящего документа, к которому надо создать квитанцию, `{documentAlias}` - ключ, определяющий тип квитанции: `accept` - квитанция о приемке, `decline` - квитанция об отклонении, `uvutoch` - запрос уточнения.

# 3. Примеры использования

## 3.1. Получение и процессинг УПД СЧФДОП документа 

Для получения и обработки входящего УПД пользователю необходимо авторизоваться, получить список документов для обработки, получить квитанции для каждого из документов, подписать и отправить эти квитанции, дождаться следующей пачки квитанций для каждого из документов, подписать и отправить эти квитанции. Далее необходимо либо сформировать ответный титул и принять документ, либо сформировать Уведомление об уточнении и отправить документ на уточнение.

Необходимы шаги по обработке входящих УПД:

1.  Авторизация
2.  Получение списка входящих документов
3.  Получение квитанций, ожидающих подписания
4.  Подписание и отправка квитанций
5.  Формирование титула и принятие документа
6.  Формирование и отправка уведомления об уточнении.

> **Комментарий**. Пункты 5 и 6 взаимоисключающие.

### 3.1.1. Авторизация 

Для авторизации в системе по сертификату необходимо выполнить запрос:
```
### Получение токена отправителя
POST http://{{host}}/api/security/token
Api-Version: v1.2
Content-Type: application/json

{
    "thumbprint": "7780EF57BFD4546698874FA87C5712B20E2D6A62",
    "serialNumber": "548740544906016617136475"
}
```
В случае, если в системе есть компания, которая зарегистрирована с таким сертификатом, то в ответ придет зашифрованное на этот сертификат сообщение. 

В сообщении содержится авторизационный токен, который необходимо указывать во всех запросах к API в заголовке `Api-Token: {{token}}`.

### 3.1.2. Получение списка входящих документов

Для получения списка входящих документов необходимо выполнить запрос:
```
### Получение входящих документов
GET http://{{host}}/api/package?packageTypes[0]=IN&documentFlows[0]=universal_invoice_and_waybill&packageStates[0]=utd_waiting_for_buyer
Api-Version: v1.2
Api-Token: {{token}}
Content-Type: application/json
```
В ответе будет структура, которая содержит список всех входящих УПД СЧФДОП документов, по которым документооборот еще не завершен.

### 3.1.3. Получение квитанций, ожидающих подписания

Для начала процессинга документов необходимо получить все сообщения, которые относятся к документу:
```
GET http://{{host}}/api/package/{{id}}/content
Api-Version: v1.2
Api-Token: {{token}}
Content-Type: application/json
```
В ответе будет структура, содержащая список всех сообщений к определенному документу, идентификатор которого указан в параметре `{{id}}`. Из них необходимо получить сообщения, которые необходимо подписать и отправить.

Все такие сообщения будут иметь статус `for_signing` и у них будет отсутствовать контент поля `signature`.

### 3.1.4. Подписание и отправка квитанций

Квитанции, полученные на предыдущем шаге, необходимо подписать отсоединенной подписью и отправить на адрес:
```
POST http://{{host}}/api/signing/{{receipt_id}}
Api-Version: v1.2
Api-Token: {{token}}
Content-Type: application/json

{
   "signature": "",
   "content": "{{ receipt_content }}"
}
```
Где `{{receipt_id}}` - идентификатор сообщения из ответной структуры `/api/package/{{ id}}/content`, а `{{ receipt_content }}` - base64 тело сообщения (квитанции).

После подписания и отправки квитанций необходимо дождаться появления новых сообщений путем периодической проверки:
```
GET http://{{host}}/api/package/{{id}}/content
```
Во второй итерации должно появиться новое сообщение со статусом `for_signing`. Его необходимо также подписать и отправить, используя вышеупомянутый метод.
```
POST http://{{host}}/api/signing/{{receipt_id}}
```
### 3.1.5. Формирование титула и принятие документа

В случае, если необходимо принять документ, то нужно выполнить следующие действия:
```
### Создание титула покупателя
POST http://{{host}}/api/service/receipt/create/{{seller_title_id}}/accept
```
где `{{seller_title_id}}` - идентификатор документа титула отправителя (`'typesystemName' =\> 'on_schfdoppr'`) из ответной структуры `GET http://{{host}}/api/package/{{id}}/content`.
```
### Принятие УПД
POST http://{{host}}/api/flow/accept/{{seller_title_id}}
Api-Version: v1.2
Api-Token: {{token}}
Content-Type: application/json

{

    "content": "{{ utd_buyer_title_content }}",
    "signature": ""
}
```
где `{{ utd_buyer_title_content }}` - ответная структура вызова предыдущего метода.

### 3.1.6. Формирование и отправка уведомления об уточнении

В случае, если необходимо сформировать уведомление об уточнении выполняется запрос:
```
### Генерация уведомления об уточнении
POST http://{{host}}/api/service/receipt/create/{{seller_title_id}}/uvutoch
Api-Version: v1.2
Api-Token: {{token}}
Content-Type: application/json

{
    "clarification": "Недостача",
    "signor": {
       "position": "\\u0414\\u043e\\u043b\\u0436\\u043d\\u043e\\u0441\\u0442\\u044c",
       "surname": "\\u0424\\u0430\\u043c\\u0438\\u043b\\u0438\\u044f",
       "name": "\\u0418\\u043c\\u044f",
       "patronymic": "\\u041e\\u0442\\u0447\\u0435\\u0441\\u0442\\u0432\\u043e"
    }
}
```
Если необходимо отклонить документ выполняется запрос:
```
### Отклонение УПД
POST http://{{host}}/api/flow/decline/{{seller_title_id}}
Api-Version: v1.2
Api-Token: {{receiver_token}}
Content-Type: application/json

{
    "signature": "",
    "content": "{{ uvutoch_content }}"
}
```
где `{{ uvutoch_content }}` - ответная структура вызова предыдущего метода.

[OpenApi]: diflow.json